<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Kolon 쇼핑몰</title>
    <style>
        :root{--bg:#faf9fb; --card:#ffffff; --ink:#1d1b20; --muted:#7c7587; --border:#ece7f6; --pill:#f6f2ff; --tint:#f1eaff; --accent:#6b47d6; --shadow:0 8px 24px rgba(0,0,0,.08);}
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif}
        .container{max-width:1100px;margin:0 auto;padding:0 18px}
        header{position:sticky;top:0;z-index:30;background:var(--bg);border-bottom:1px solid var(--border)}
        .bar{display:flex;align-items:center;justify-content:space-between;height:64px}
        .left,.right{display:flex;align-items:center;gap:12px}
        .brand{font-weight:800;font-size:22px;text-decoration:none;color:inherit}
        .icon-btn{width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:var(--card);display:grid;place-items:center;cursor:pointer;text-decoration:none;color:inherit}
        .pill{border:1px solid var(--border);background:var(--pill);height:30px;padding:0 10px;border-radius:999px;display:inline-flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;text-decoration:none;color:inherit}
        .badge{min-width:18px;height:18px;border-radius:999px;background:var(--accent);color:#fff;display:inline-flex;align-items:center;justify-content:center;font-size:12px;padding:0 6px;margin-left:6px}
        .mega{position:absolute; top:64px; left:0; width:min(760px, calc(100vw - 24px)); max-height:70vh; overflow:auto; background:#fff; border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); display:none; z-index:50; animation:drop .16s ease;}
        .mega.show{display:block}
        @keyframes drop{from{transform:translateY(-6px);opacity:.0}to{transform:none;opacity:1}}
        .mega-inner{display:grid;grid-template-columns:200px 1fr}
        .cats{background:var(--pill);border-right:1px solid var(--border);padding:10px;display:flex;flex-direction:column;gap:8px}
        .cat-btn{all:unset;display:block;width:100%;cursor:pointer;box-sizing:border-box;padding:10px 12px;border-radius:10px;font-weight:700;color:#2d2a34}
        .cat-btn:hover{background:#f4f0ff}
        .cat-btn.active{background:#fff;color:var(--accent);border:1px solid #e6defe}
        .subs{padding:12px}
        .subs h3{margin:2px 0 10px;font-size:15px}
        .subs-list{display:flex;flex-direction:column;gap:10px}
        .sub-link{all:unset;cursor:pointer;display:block;text-align:left;padding:12px;border-radius:12px;border:1px solid var(--border);background:#fff;color:#2b2930;font-size:14px}
        .sub-link:hover{background:#fbf9ff;border-color:#d9cff7}
        .sub-link.active{border-color:#d9cff7;background:#fbf9ff}
        .third{margin-top:10px;display:none}
        .third h4{margin:0 0 8px 2px;font-size:13px;color:#4b445a}
        .third-list{display:flex;flex-wrap:wrap;gap:8px}
        .chip{all:unset;cursor:pointer;display:inline-block;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:13px;color:#2b2930}
        .chip:hover{background:#f7f4ff;border-color:#d9cff7}
        .search-container{position:relative;flex:1;max-width:400px;margin:0 20px}
        .search-box{width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:8px;background:var(--card)}
        .product-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));gap:20px;margin:20px 0}
        .product-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;box-shadow:var(--shadow);cursor:pointer;text-decoration:none;color:inherit}
        .product-card:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(0,0,0,.12)}
        .product-img{width:100%;height:200px;background:var(--pill);border-radius:8px;margin-bottom:12px;background-size:cover;background-position:center}
        .product-name{font-weight:600;margin-bottom:8px}
        .product-price{color:var(--accent);font-weight:700;font-size:18px}
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="bar">
                <div class="left">
                    <a href="index.html" class="brand">Kolon</a>
                    <button class="icon-btn" onclick="toggleMega()">☰</button>
                </div>
                <div class="search-container">
                    <form action="search.html" method="GET">
                        <input type="text" name="q" class="search-box" placeholder="검색어를 입력하세요" />
                    </form>
                </div>
                <div class="right">
                    <a href="cart.html" class="icon-btn">🛒</a>
                    <a href="mypage.html" class="icon-btn">👤</a>
                    <a href="login.html" class="pill">로그인</a>
                </div>
            </div>
        </div>
        
        <div class="mega" id="megaMenu">
            <div class="mega-inner">
                <div class="cats">
                    <button class="cat-btn active" onclick="showCategory('fashion')">패션</button>
                    <button class="cat-btn" onclick="showCategory('food')">식품</button>
                    <button class="cat-btn" onclick="showCategory('electronics')">가전</button>
                </div>
                <div class="subs">
                    <div id="fashion" class="category-content">
                        <h3>패션</h3>
                        <div class="subs-list">
                            <a href="category.html?cat=men" class="sub-link">남성의류</a>
                            <a href="category.html?cat=women" class="sub-link">여성의류</a>
                            <a href="category.html?cat=shoes" class="sub-link">신발</a>
                            <a href="category.html?cat=accessories" class="sub-link">액세서리</a>
                        </div>
                    </div>
                    <div id="food" class="category-content" style="display:none">
                        <h3>식품</h3>
                        <div class="subs-list">
                            <a href="category.html?cat=snacks" class="sub-link">간식</a>
                            <a href="category.html?cat=beverages" class="sub-link">음료</a>
                            <a href="category.html?cat=health" class="sub-link">건강식품</a>
                        </div>
                    </div>
                    <div id="electronics" class="category-content" style="display:none">
                        <h3>가전</h3>
                        <div class="subs-list">
                            <a href="category.html?cat=kitchen" class="sub-link">주방가전</a>
                            <a href="category.html?cat=living" class="sub-link">생활가전</a>
                            <a href="category.html?cat=digital" class="sub-link">디지털</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <h2>인기 상품</h2>
        <div id="product-list" class="product-grid">
            로딩 중...
        </div>
    </main>

    <script>
        function toggleMega() {
            const mega = document.getElementById('megaMenu');
            mega.classList.toggle('show');
        }

        function showCategory(cat) {
            const buttons = document.querySelectorAll('.cat-btn');
            const contents = document.querySelectorAll('.category-content');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            contents.forEach(content => content.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(cat).style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('product-list');
            try {
                const res = await fetch('/api/products');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                container.innerHTML = '';
                
                if (!data.items || data.items.length === 0) {
                    container.innerHTML = '<p>등록된 상품이 없습니다.</p>';
                    return;
                }

                data.items.forEach(item => {
                    const card = document.createElement('a');
                    card.href = `product.html?id=${item.id}`;
                    card.className = 'product-card';
                    card.onclick = () => addToRecentlyViewed(item);
                    card.innerHTML = `
                        <div class="product-img" style="background-image:url('images/${item.image || 'default.jpg'}')"></div>
                        <div class="product-name">${item.name}</div>
                        <div class="product-price">₩${item.price.toLocaleString()}</div>
                    `;
                    container.appendChild(card);
                });
            } catch (err) {
                console.error('상품 로드 실패:', err);
                container.innerHTML = '<p>상품을 불러오지 못했습니다.</p>';
            }
        });

        function addToRecentlyViewed(product) {
            let recent = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            recent = recent.filter(p => p.id !== product.id);
            recent.unshift(product);
            recent = recent.slice(0, 10);
            localStorage.setItem('recentlyViewed', JSON.stringify(recent));
        }
    </script>
</body>
</html>