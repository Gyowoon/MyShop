<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Kolon - 검색 결과</title>
    <style>
        body{font-family:system-ui,sans-serif;background:#faf9fb;margin:0}
        .container{max-width:1100px;margin:0 auto;padding:20px}
        .header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-bottom:1px solid #ece7f6}
        .brand{font-size:24px;font-weight:800;color:#6b47d6;text-decoration:none}
        .search-container{position:relative;flex:1;max-width:400px;margin:0 20px}
        .search-box{width:100%;padding:8px 12px;border:1px solid #ece7f6;border-radius:8px;background:#fff}
        .search-info{margin:20px 0;color:#7c7587}
        .product-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));gap:20px;margin:20px 0}
        .product-card{background:#fff;border:1px solid #ece7f6;border-radius:12px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.05);cursor:pointer;text-decoration:none;color:inherit}
        .product-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.08)}
        .product-img{width:100%;height:200px;background:#f6f2ff;border-radius:8px;margin-bottom:12px;background-size:cover;background-position:center}
        .product-name{font-weight:600;margin-bottom:8px}
        .product-price{color:#6b47d6;font-weight:700;font-size:18px}
        .no-results{text-align:center;padding:60px 20px;color:#7c7587}
        .no-results h3{margin-bottom:10px}
        .no-results a{color:#6b47d6;text-decoration:none}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="brand">Kolon</a>
            <div class="search-container">
                <form action="search.html" method="GET">
                    <input type="text" name="q" class="search-box" id="searchInput" placeholder="검색어를 입력하세요" />
                </form>
            </div>
        </div>
        
        <div class="search-info" id="searchInfo"></div>
        <div id="searchResults" class="product-grid"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q') || urlParams.get('category') || '';
            const category = urlParams.get('cat') || urlParams.get('category');
            
            document.getElementById('searchInput').value = query;
            
            if (query || category) {
                await performSearch(query, category);
            } else {
                showNoResults('검색어를 입력해주세요.');
            }
        });

        async function performSearch(query, category) {
            const container = document.getElementById('searchResults');
            const info = document.getElementById('searchInfo');
            
            try {
                // API에서 검색 결과 가져오기
                let url = '/api/products';
                const params = new URLSearchParams();
                
                if (query) params.append('search', query);
                if (category) params.append('category', category);
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    const searchTerm = query || category;
                    info.textContent = `"${searchTerm}" 검색 결과: ${data.items.length}개`;
                    displayResults(data.items);
                } else {
                    showNoResults(query || category);
                }
                
            } catch (error) {
                console.error('검색 오류:', error);
                showNoResults(query || category, true);
            }
        }

        function displayResults(products) {
            const container = document.getElementById('searchResults');
            container.innerHTML = '';
            
            products.forEach(product => {
                const card = document.createElement('a');
                card.href = `product.html?id=${product.id}`;
                card.className = 'product-card';
                card.onclick = () => addToRecentlyViewed(product);
                
                card.innerHTML = `
                    <div class="product-img" style="background-image:url('images/${product.image || 'default.jpg'}')"></div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">₩${product.price.toLocaleString()}</div>
                `;
                container.appendChild(card);
            });
        }

        function showNoResults(searchTerm, isError = false) {
            const container = document.getElementById('searchResults');
            const info = document.getElementById('searchInfo');
            
            info.textContent = isError ? '검색 중 오류가 발생했습니다.' : `"${searchTerm}" 검색 결과가 없습니다.`;
            
            container.innerHTML = `
                <div class="no-results">
                    <h3>검색 결과가 없습니다</h3>
                    <p>다른 검색어로 다시 시도해보세요.</p>
                    <p><a href="index.html">홈으로 돌아가기</a></p>
                </div>
            `;
        }

        function addToRecentlyViewed(product) {
            let recent = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            recent = recent.filter(p => p.id !== product.id);
            recent.unshift(product);
            recent = recent.slice(0, 10);
            localStorage.setItem('recentlyViewed', JSON.stringify(recent));
        }
    </script>
</body>
</html>