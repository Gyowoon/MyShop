<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Kolon - 최근 본 상품</title>
    <style>
        body{font-family:system-ui,sans-serif;background:#faf9fb;margin:0}
        .container{max-width:1100px;margin:0 auto;padding:20px}
        .header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-bottom:1px solid #ece7f6}
        .brand{font-size:24px;font-weight:800;color:#6b47d6;text-decoration:none}
        .product-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));gap:20px;margin:20px 0}
        .product-card{background:#fff;border:1px solid #ece7f6;border-radius:12px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.05);cursor:pointer;text-decoration:none;color:inherit;position:relative}
        .product-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.08)}
        .product-img{width:100%;height:200px;background:#f6f2ff;border-radius:8px;margin-bottom:12px;background-size:cover;background-position:center}
        .product-name{font-weight:600;margin-bottom:8px}
        .product-price{color:#6b47d6;font-weight:700;font-size:18px;margin-bottom:12px}
        .view-date{color:#7c7587;font-size:12px}
        .remove-btn{position:absolute;top:10px;right:10px;width:24px;height:24px;border-radius:50%;background:rgba(0,0,0,0.5);color:#fff;border:none;cursor:pointer;display:none}
        .product-card:hover .remove-btn{display:block}
        .empty-state{text-align:center;padding:60px 20px;color:#7c7587}
        .clear-all-btn{padding:8px 16px;background:#e74c3c;color:#fff;border:none;border-radius:4px;cursor:pointer;margin-bottom:20px}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="brand">Kolon</a>
            <a href="mypage.html" style="color:#6b47d6;text-decoration:none">← 마이페이지</a>
        </div>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin:20px 0">
            <h2>최근 본 상품</h2>
            <button class="clear-all-btn" onclick="clearAllHistory()" id="clearBtn" style="display:none">전체 삭제</button>
        </div>
        
        <div id="recentlyViewedList" class="product-grid"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadRecentlyViewed();
        });

        function loadRecentlyViewed() {
            const recentItems = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            const container = document.getElementById('recentlyViewedList');
            const clearBtn = document.getElementById('clearBtn');
            
            if (recentItems.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>최근 본 상품이 없습니다</h3><p><a href="index.html" style="color:#6b47d6">쇼핑하러 가기</a></p></div>';
                clearBtn.style.display = 'none';
                return;
            }
            
            clearBtn.style.display = 'block';
            container.innerHTML = '';
            
            recentItems.forEach((item, index) => {
                const card = document.createElement('a');
                card.href = `product.html?id=${item.id}`;
                card.className = 'product-card';
                
                card.innerHTML = `
                    <button class="remove-btn" onclick="removeFromHistory(${index}, event)">×</button>
                    <div class="product-img" style="background-image:url('images/${item.image || 'default.jpg'}')"></div>
                    <div class="product-name">${item.name}</div>
                    <div class="product-price">₩${item.price.toLocaleString()}</div>
                    <div class="view-date">${getTimeAgo(item.viewedAt)}</div>
                `;
                
                container.appendChild(card);
            });
        }

        function removeFromHistory(index, event) {
            event.preventDefault();
            event.stopPropagation();
            
            if (confirm('이 상품을 최근 본 상품에서 제거하시겠습니까?')) {
                const recentItems = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
                recentItems.splice(index, 1);
                localStorage.setItem('recentlyViewed', JSON.stringify(recentItems));
                loadRecentlyViewed();
            }
        }

        function clearAllHistory() {
            if (confirm('모든 최근 본 상품 내역을 삭제하시겠습니까?')) {
                localStorage.removeItem('recentlyViewed');
                loadRecentlyViewed();
            }
        }

        function getTimeAgo(timestamp) {
            if (!timestamp) return '방금 전';
            
            const now = new Date();
            const viewTime = new Date(timestamp);
            const diffInMinutes = Math.floor((now - viewTime) / (1000 * 60));
            
            if (diffInMinutes < 1) return '방금 전';
            if (diffInMinutes < 60) return `${diffInMinutes}분 전`;
            if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}시간 전`;
            return `${Math.floor(diffInMinutes / 1440)}일 전`;
        }

        // 상품 클릭 시 타임스탬프 업데이트
        function updateViewTime(productId) {
            const recentItems = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            const item = recentItems.find(item => item.id === productId);
            if (item) {
                item.viewedAt = new Date().toISOString();
                localStorage.setItem('recentlyViewed', JSON.stringify(recentItems));
            }
        }
    </script>
</body>
</html>